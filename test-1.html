<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>Visualization Insights</title>

	<!-- Bootstrap Core CSS -->
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

	<!-- Custom CSS -->
	<link href="css/custom.css" rel="stylesheet">

	<!-- Custom Fonts -->
	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

	<!-- Custom JavaScript -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="js/timeme.js"></script>

	<!-- <script src="https://d3js.org/d3.v4.min.js"></script> -->
	<script type="text/javascript">
		var urlParams = new URLSearchParams(window.location.search);

		var prolific_PID = urlParams.get('PROLIFIC_PID');
		var session_ID = urlParams.get('SESSION_ID');
		var mod = urlParams.get('modulo');
		var conditions = urlParams.get('vis').split(",");
		var incentives = urlParams.get('alpha').split(",");

		TimeMe.initialize({
			currentPageName: "test-1", // current page
			idleTimeoutInSeconds: 120, // stop recording time due to inactivity
		});
	</script>
</head>
<body>
	<div class="row">
		<div class="container-fluid">
			<div class="col-md-10 col-md-offset-1">
				<div class="row">
					<div class="col-md-10 col-md-offset-1">
						<h2 class="margin-top-md">Visualization Insights study</h2><br>

						<h2>Tutorial</h2>

						<p>You will get to know your task on this tutorial page. Please read carefully and try out the task on this page before proceeding to the actual study.</p><br>

						<!-- In each trial, we will show you 10 graphs. Your goal is to identify the regions where your company is making a profit on average, from these graphs. Each region has 200 stores, but we only have the data for a randomly selected sample of 20 stores from each region. -->

						<h3>Background story of your task</h3>

						<div class="row">
							<div class="col-sm-12">
								<p><img class="vis-desc" src="images/ci_calc_plot.png" align="right"/>You are a manager supervising the sales of your group of stores across 10 regions. Each region has 200 stores. Your job is to identify the promising regions where the average store is <span class="highlight2">making a profit</span>. So far, however, you've only received sales data for 20 random stores (out of 200) in each region. To help you evaluate the regional profits with imcomplete data, your business analyst used statistics and created plots, like the ones shown on the right.
								</p><br>
								<p>Keep in mind that the data shown in each graph is only of a randomly selected sample from a larger dataset. Hence, even if the mean profit for the sample shown in the graph is greater than zero, it may not actually be the case in the actual dataset. Once you submit your answers for this round, we will show you the graphs with the complete dataset, so that you can compare your answers to the actual results in the next screen.</p><br>
							</div>
						</div>

						<div class="row">
							<div class="col-sm-12">
								<h3>Reward structure</h3>
								<p><img id="payoff-img" src="images/payoff_5.png" align="right">By clicking on a region, you indicate that you think the region has a profit greater than zero. Your goal is to maximise your points.
								<ul>
									<li>If you <b>click</b> on a region, and that region <b>does have</b> a profit greater than zero, on average, you will receive 20 points. <!-- This is a <i>True Positive</i>.--></li>
									<li>If you <b>click</b> on a region, and that region <b>does not</b> have a profit greater than zero, on average, you will lose <span class="highlight">380 points.</span><!--  This is a <i>False Positive</i>. --></li>
									<li>If you <b>do not click</b> on a region, and that region <b>does not</b> have a profit greater than zero on average, you will receive 20 points. <!-- This is a <i>True Negative</i>. --></li>
									<li>If you <b>do not click</b> on a region, and that region <b>does have</b> a profit greater than zero, on average, you will lose 20 points. <!-- This is a <i>False Negative</i>. --></li>
								</ul>
								</p>
							</div>
						</div>

						<h3 class="margin-top-sm">Try out your task</h3>
						<p><i>Click on the regions</i> you think are making a profit based on this data. You can click on multiple stores.</p>
					</div>
				</div>
				<div class="row">
					<div class="col-lg-2 col-sm-3 col-lg-offset-1">
						<div class = "question-container" id = "opt-1"></div>
					</div>
					<div class="col-lg-2 col-sm-3">
						<div class = "question-container" id = "opt-2"></div>
					</div>
					<div class="col-lg-2 col-sm-3">
						<div class = "question-container" id = "opt-3"></div>
					</div>
					<div class="col-lg-2 col-sm-3">
						<div class = "question-container" id = "opt-4"></div>
					</div>
					<div class="col-lg-2 col-sm-3">
						<div class = "question-container" id = "opt-5"></div>
					</div>
					<div class="col-lg-2 col-sm-3 col-lg-offset-1">
						<div class = "question-container" id = "opt-6"></div>
					</div>
					<div class="col-lg-2 col-sm-3">
						<div class = "question-container" id = "opt-7"></div>
					</div>
					<div class="col-lg-2 col-sm-3">
						<div class = "question-container" id = "opt-8"></div>
					</div>
					<div class="col-lg-2 col-sm-3">
						<div class = "question-container" id = "opt-9"></div>
					</div>
					<div class="col-lg-2 col-sm-3">
						<div class = "question-container" id = "opt-10"></div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class = "row">
		<div class="container">
			<div class="btn-container">
				<div class="btn" id="submit-btn">Submit</div>
			</div>
		</div>
	</div>
</body>
<script type="text/javascript">
	var selected = [];

	var img_order = [...Array(10).keys()].map( i => ++i );
	// var i_level = Math.floor(Math.random() * levels.length);

	url = "https://raw.githubusercontent.com/MUCollective/vis-insight-reliability/stimuli/plots/example/profits-t0-p0.5-";

	$("div#opt-1").append('<img class = "question-graphic">').children().attr("src", url + img_order[0] + ".png");
	$("div#opt-2").append('<img class = "question-graphic">').children().attr("src", url + img_order[1] + ".png");
	$("div#opt-3").append('<img class = "question-graphic">').children().attr("src", url + img_order[2] + ".png");
	$("div#opt-4").append('<img class = "question-graphic">').children().attr("src", url + img_order[3] + ".png");
	$("div#opt-5").append('<img class = "question-graphic">').children().attr("src", url + img_order[4] + ".png");
	$("div#opt-6").append('<img class = "question-graphic">').children().attr("src", url + img_order[5] + ".png");
	$("div#opt-7").append('<img class = "question-graphic">').children().attr("src", url + img_order[6] + ".png");
	$("div#opt-8").append('<img class = "question-graphic">').children().attr("src", url + img_order[7] + ".png");
	$("div#opt-9").append('<img class = "question-graphic">').children().attr("src", url + img_order[8] + ".png");
	$("div#opt-10").append('<img class = "question-graphic">').children().attr("src", url + img_order[9] + ".png");

	$(function() {
		$('.question-container').hover(function() {
			$(this).css('background', '#3CA8FF');
		}, function() {
			// on mouseout, reset the background colour
			$(this).css('background', '');
		});
	});

	$(".question-container").click(function () {
		$(this).toggleClass("selected");
		var id_str = $(this).children().attr("src").split("-");
		var id = id_str[id_str.length - 1].split(".")[0];

		if (!selected.includes(id)) {
			selected.push(id);
		} else {
			var index = selected.indexOf(id);
			if (index !== -1) selected.splice(index, 1);
		}
	});

	$("div#submit-btn").on('click', submitResponse);

	// send response to DB
	function submitResponse() {
		// uses global value for 'selected'
		// Time spent on page
		var t = Math.round(TimeMe.getTimeOnCurrentPageInSeconds() * 1000) / 1000;

		window.location.href = 'test-2.html?PROLIFIC_PID='+prolific_PID+'&SESSION_ID='+session_ID+'&modulo='+mod+'&vis='+conditions+'&alpha='+incentives+'&selected='+selected+'';
	}
</script>
</html>
